ruleset LocationData {
  meta {  
//b505289x4.prod
    name "Locatino Data"
    description <<
      Checkin In With Foursquare
    >>
    author ""
    logging off
	use module a169x701 alias CloudRain
	use module a41x186  alias SquareTag
	
	provides get_location_data
  }
  
   dispatch {
	}

	global {
		get_location_data = function(key) {
			app:locationData.pick("$.." + key)
		}
	}
	

	rule add_location_item is active {
		select when pds new_location_data

		pre {
			k = event:attr("key");
			v = event:attr("value");

			map = {};
		}
		{
			send_directive(k) with location = v;
		}
		always {
			set app:locationData map.put([k],v);
			set ent:locationData map.put([k],v);
		}
	}


